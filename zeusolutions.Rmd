---
title: "Report title"
subtitle: "Subtitle"
author: "Report prepared for Black Saber Software by Zeusolutions"
date: 2021-04-21
lang: "en"
output:
  pdf_document:
    template: report.tex
    toc: true
    toc_depth: 2
titlepage: true
titlepage-color: "6C3082"
titlepage-text-color: "FFFFFF"
titlepage-rule-color: "FFFFFF"
titlepage-rule-height: 2
---

```{r, message = FALSE, echo=FALSE}
library(tidyverse)
# Run `install.packages("kableExtra")`, install.packages("gtsummary"), install.packages('huxtable') and install.packages("broom.mixed") if needed
library(huxtable)
library(kableExtra)
library(gtsummary)
# this should supress all code and messages
knitr::opts_chunk$set(echo=FALSE)
```

# General comments (you can delete this section)

_You can delete this section, and if you want to check what it said, just open a template from the package again. You don't have to use this particular template, but you DO need to write you report in RMarkdown and include a cover page._

_The cover page must have:_

*	_A title and subtitle_
* _"Report prepared for Black Saber Software by" your company name_
*	_Date (assessment submission date is fine)_

_You can change the colour of this cover to any colour you would like by replacing 6C3082 in the YAML above (line 11) to another hex code. You could use this tool to help you:_ https://htmlcolorcodes.com/color-picker/

\newpage
# Executive summary

_Guidelines for the executive summary:_

* _No more than two pages_
* _Language is appropriate for a non-technical audience_
* _Bullet points are used where appropriate_
*	_A small number of key visualizations and/or tables are included_
*	_All three research questions are addressed_


\newpage
# Technical report
_This part of the report is much more comprehensive than the executive summary. The audience is statistics/data-minded people, but you should NOT include code or unformatted R output here._


## Introduction

_Provide a brief introduction to your report and outline what the report will cover. This section is valuable for setting scope and expectations. _

### Research questions
_Use bullet points to to describe the research questions you are going to address. Write in full sentences._

## Informative title for section addressing a research question

_For each research question, you will want to briefly describe any data manipulation, show some exploratory plots/summary tables, report on any methods you use (i.e. models you fit) and the conclusions you draw from these_

```{r include = FALSE, fig.show='hide'}
# This chunk provides an example of some things you can do with RMarkdown to make your report creation process easier

# read in the data
current_employees <- read_csv("data/black-saber-current-employees.csv")

# create a visualisation
my_plot <- current_employees %>% 
  ggplot(aes(x = productivity)) +
  geom_histogram(colour = "grey", fill = "#6C3082") +
  theme_minimal() +
  labs(title = "Look! A title. But do you want a title or a caption for your report?", x = "This is a changed x label")

# save your plot in your images folder, you can specify the height and width, too
# saving this means you can add the image to your exectuve summary without having to run or rerun the code, if you wish
ggsave("images/example.png", width = 7, height = 4)

# notice how the image is included with the ![](file/path.png) below
```

```{r, warning=FALSE}
gender_to_currentroles <- select(current_employees, gender, role_seniority) 
hierarchy <- c('Entry-level','Junior I','Junior II','Senior I','Senior II','Senior III','Manager', 'Director','Vice president')
#creating visual to display  reported gender ratios of current employees
gender_to_currentroles%>%
  gather(gender,role_seniority)%>%
  mutate(roles = factor(role_seniority))%>%
  ggplot(aes(roles,fill=gender))+
  geom_bar(preserve="single",position="dodge")+
  scale_x_discrete(limits = hierarchy) +
  theme(axis.text.x = element_text(angle=30))+
  labs(title = "Gender Parity of Current Employees",fill="Gender")+
  xlab("Role Seniority")
ggsave("images/currentgender.png", width = 7, height = 4)
```
![](images/currentgender.png)

```{r wrangle_employee_data, message = FALSE}
current_employees <- current_employees
```

## (Hiring Question) Fairness of the AI Recruitment Pipeline Manager

The company Black Saber has a new AI recruitment pipeline manager that has been trialing for the Data and Software teams. The board has concerns about the process and questions whether or not it is fair and based on value and talent of each applicant. We have been given the data for each phase of the process, in which there are a total of three. Through each phase there is certain data collected through question and tasks in which the AI uses to narrow down the field of applicants from one phase to another. We want to determine what factors play a major role in being hired through Black Saber's recruitment pipeline manager.

```{r wrangle_application_data, message = FALSE}
phase1_applicants <- read_csv("data/phase1-new-grad-applicants-2020.csv")
phase2_applicants <- read_csv("data/phase2-new-grad-applicants-2020.csv")
phase3_applicants <- read_csv("data/phase3-new-grad-applicants-2020.csv")
final_hires <- read_csv("data/final-hires-newgrad_2020.csv")

# Adds Applicant Info to Phase 3
phase3_applicants <- phase3_applicants %>%
  left_join(phase2_applicants, by = "applicant_id")
# Adds Applicant Info to Final Hires
final_hires <- final_hires %>%  
  left_join(phase3_applicants, by = "applicant_id")
```

### (Phase 1) Defining Features of the Application Form

The first phase of the hiring pipeline is submission of an application form, cover letter and CV. Each line of `phase1-new-grad-applicants-2020.csv` contains the information of each applicant in phase 1:

* `applicant_id` = A unique ID given to each applicant in Phase 1
* `team_applied_for` = Software or Data
* `cover_letter` = 1 if present, 0 if not.
* `cv` = 1 if present, 0 if not
* `gpa` = 0.0 to 4.0
* `gender` = 'Man', 'Woman', or 'Prefer not to say' as the only options
* `extracurriculars` = 0, 1 or 2. Description in which is accessed automatically by keywords where 2 indicates high, 1 indicates some and 0 indicates no relevant skill building extracurriculars.
* `work_experience` = 0, 1 or 2. Description in which is accessed automatically by keywords where 2 indicates high, 1 indicates some and 0 indicates no relevant work experiences.

```{r}
phase1_applicants[1:5,] %>% 
  kbl(caption = "The first five applicants from phase 1 of the hiring pipeline", booktabs = T) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE, position = "left", latex_options = "hold_position") %>% 
  row_spec(0, angle = 45)

```

Similarly, we are also given the list of applicants who have made it to phase 2 along with the factors assessed in phase 2. However, in this section we are only interested in which applicants made it to phase 2. For this reason we will create a variable called `passed_1` and set it to 1, if the applicant made it from phase 1 to phase 2 and 0, if not. This will be the response variable we are interested in for developing our model. The other variables will be fixed effects besides `team_applied_for`. We believe that `team_applied_for` should be added as a random effect because each team has a different set of required skills and/or experiences. Other than that, since each row corresponds to a unique applicant, this suggests that the observations are independent, hence our assumptions are not violated. We want to determine which is the most impactful component of the application form that allows the applicants to proceed to phase 2 of the hiring process.

```{r}
phase1_applicants <- phase1_applicants %>% 
  mutate(passed_1 = as.integer(applicant_id %in% phase2_applicants$applicant_id)) 
```

Given the binomial response variable and random effect, we will be constructing a generalized linear mixed model. Before constructing the model, we want to first consider the gender distribution for those who passed phase 1 and those who did not. In addition, consider also the marginal probabilities and odd ratios.\newpage

```{r}
table_gender_passsed <- table(phase1_applicants$gender, phase1_applicants$passed_1)
table_gender_passsed %>% 
  kbl(col.names = c("Did Not Pass Phase 1", "Passed Phase 1"),caption = "The number of applicants that passed phase 1 based on gender", booktabs = T) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE, position = "left", latex_options = "hold_position")

prop.table(table_gender_passsed, margin = 2) %>% 
  kbl(col.names = c("Did Not Pass Phase 1", "Passed Phase 1"),caption = "The probability of an applicant's gender given that they pass phase 1", booktabs = T) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE, position = "left", latex_options = "hold_position")

table_mw_passed <- table_gender_passsed[-2,]
odds_mw_passes <- (table_mw_passed[2,2]/table_mw_passed[2,1])/(table_mw_passed[1,2]/table_mw_passed[1,1]) 
```

Hence from the table above, given that the applicant passes phase 1, the probability that their gender is a 'Man' is 48%, whereas a 'Woman' is 51%. Also, the odds ratio of Woman vs Man who pass phase 1 is approximately 0.96. That is, the odds of a 'Woman' passing phase 1 is less than that of a 'Man'. This odds ratio is relatively close to 1, hence there is no reason to suspect that there are any gender biases in those who passed phase 1. 

Now consider the Generalized linear mixed model.

```{r message=FALSE, warning=FALSE}
full_p1_model <- lme4::glmer(passed_1 ~ cover_letter + cv + gpa + gender + extracurriculars + work_experience + (1|team_applied_for), family = binomial(link="logit"), data = phase1_applicants)

tbl_regression(full_p1_model) %>% 
  as_hux_table() %>%
  set_caption("Generalized linear mixed model of applicants who passed Phase 1") %>% 
  set_position("left") %>% 
  set_top_padding(0.5) %>% 
  set_bottom_padding(0.5)
```

Based on the model, it is evident that `gpa`, `extracurriculars` and `work_experience` have the most significant effect on passing Phase 1, based on their p-values. Hence we can conclude that the most impactful components of the application form that allowd the applicants to proceed to phase 2 of the hiring process are `gpa`, `extracurriculars` and `work_experience`.

### (Phase 2) AI Scoring Influences

## (Promotion Question)
Black Saber aims to promote an equitable and inclusive work environment based on merit. The board wants to assure that its promotion processes are not only fair, but strictly based on talent to the company. We have been given the data for the company's current employees and their key performance indicators throughout their time at the company marked by financial quarters. We wish to determine which factors contribute to employees moving up the ranks of Black Saber seniority.

### Features Recorded of Black Saber's Current Employees

While employed at Black Saber Software, employee performance indicators are recorded every financial quarter. Each line of `black-saber-current-employees.csv` contains the information of each employee at the financial quarters they were employed:

* `employee_id` = A unique ID given to each employee of Black Saber
* `gender` = 'Man', 'Woman', or 'Prefer not to say' as the only options
* `team` = Divisions of Black Saber staff categorized into: "Software", "People and talent", "Operations", "Marketing and sales", "Legal and financial", "Design", "Data", and "Client services".
* `financial_q` = Financial quarter where following features were recorded.
* `role_seniority` = Hierarchy of employees within each team. Rank order from least senior to most senior: 'Entry-level','Junior I','Junior II','Senior I','Senior II','Senior III','Manager', 'Director','Vice president'. 
* `leadership_for_level` = Quality of demonstrated leadership, taking into account role level. (i.e. “Appropriate for level” requires much less for entry-levelemployees than for a manager). Categorized into "Needs Improvement", "Appropriate for Level", and "Exceeds Expectations".
* `productivity` = Work output in relation to job description, rated on a 0-100 scale with 50 being satisfactory and above 50 indicating better than expected productivity.
* `salary` = Salary at at the given financial quarter (note: these are effective yearly values for the current wage, but don’t take in to account previous salary steps in the same year, etc.)

```{r five_current_employees}
sample_n(distinct(current_employees, employee_id, .keep_all = TRUE), 5) %>% 
  kbl(caption = "Five Anonymous Employees at Black Saber Software", booktabs = T) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE, position = "left", latex_options = "hold_position") %>% 
  row_spec(0, angle = 45)

```

For this question, we are interested in how many promotions an employee received while working at Black Saber Software. For this reason, we will create a variable called `number_of_promotions` counting the change in role_seniority of each employee. 
This will be the response variable we are interested in for developing our model. The other variables will be fixed effects besides `team_applied_for`. We believe that `team_applied_for` should be added as a random effect because each team has a different set of required skills and/or experiences. Other than that, since each row corresponds to a unique applicant, this suggests that the observations are independent, hence our assumptions are not violated. We want to determine which is the most impactful component of the application form that allows the applicants to proceed to phase 2 of the hiring process.

```{r promotion_data, message = FALSE}
promoted_employees <- read.csv("data/black-saber-current-employees.csv")  %>% 
    arrange(employee_id, financial_q) %>% 
    group_by(employee_id) %>% 
    mutate(number_of_promotions = max(length(unique(role_seniority)))-1)
```

Given the ... response variable and random effect, we will be constructing a ... model. Before constructing the model, we want to first consider the gender distribution in number of promotions of current employees. In addition, consider also the joint probabilities.\newpage


```{r gender_to_promotion, warning=FALSE, message = FALSE}
# Promoted_employees_dist takes only the most recent role seniority, and tracks average of all features and initial position.
promoted_employees_dist <- promoted_employees %>% 
  group_by(employee_id) %>%
  mutate(quarters_since_hiring = n()) %>% 
  group_by(employee_id) %>% 
  mutate(starting_role_seniority = first(role_seniority)) %>% 
  add_count(employee_id, leadership_for_level) %>%
  mutate(avg_leadership = leadership_for_level[n == max(n)][1]) %>%
  mutate(avg_productivity = round(mean(productivity), digits = 0)) %>%
  select(-n) %>% 
  slice(n())

gender_to_promotion <- select(promoted_employees_dist, gender, number_of_promotions) 
#creating visual to display  reported gender ratios of current employees
gender_to_promotion%>%
  ggplot(aes(number_of_promotions,fill=gender))+
  geom_bar(preserve="single",position="dodge")+
  theme(axis.text.x = element_text(angle=30))+
  labs(title = "Gender Parity in Number of Promotions of Current Employees",fill="Gender")+
  xlab("Number of Promotions") +
  ylab("Number of Employees")
ggsave("images/currentgender_promotion.png", width = 7, height = 4)
```


```{r promo_prob}
table_gender_promotion <- table(promoted_employees_dist$gender, promoted_employees_dist$number_of_promotions)
table_gender_promotion %>% 
  kbl(caption = "The number of employee promotions based on gender", booktabs = T) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE, position = "left", latex_options = "hold_position")

prop.table(table_gender_promotion, margin = 2) %>% 
  kbl(caption = "The probability of an employee's gender given number of promotions", booktabs = T) %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE, position = "left", latex_options = "hold_position")
```

From the tables above, the only time the probability of an employee being a woman is higher is given the employee has not had any promotions. Conversely, seeing that given a higher number of promotions, the probability of being a man becomes proportionally larger, a gender bias may be suspected however we will withold any conclusions until we consider our model.

## (Salary Question) Fairness of Salary assignment for current employees at Black Saber
 Information of each employee at the financial quarters they were employed will be utilized again from `black-saber-current-employees.csv`.
 
 In this section, we are interested in the fairness of salary assignment for current employees at Black Saber. We will be looking how `role_seniority`, `leadership_for_level`,`productivity`, and `gender`.
 
 

```{r, include = FALSE}
library(tidyverse)
library(lme4)
```

## Discussion

_In this section you will summarize your findings across all the research questions and discuss the strengths and limitations of your work. It doesn't have to be long, but keep in mind that often people will just skim the intro and the discussion of a document like this, so make sure it is useful as a semi-standalone section (doesn't have to be completely standalone like the executive summary)._

### Strengths and limitations

\newpage
# Consultant information
## Consultant profiles

*Complete this section with a brief bio for each member of your group. If you are completing the project individually, you only need to complete one for yourself. In that case, change the title of this section to 'Consultant profile' instead. Examples below. This section is only marked for completeness, clarity and professionalism, not 'truth' so you can write it as if we're a few years in the future. Put your current degree in as completed and/or add your first choice grad school program, whatever you like. What skills related skills would you most like to highlight? What job title do you want?*

**Andy Vu**. Andy is a junior consultant with Zeusolutions. He specializes in statistical modeling. Andy earned his Bachelor of Science, Specializing in Mathematics & Its Applications (Probability/Statistics) and Majoring in Statistics from the University of Toronto in 2021. 

**Ethelia Choi**. 

**James F. Kanu**. James is a junior consultant with Zeusolutions. He specializes in data visualization. James earned his Bachelor of Science, Majoring in Mathematics and Minoring in Computer Science and Statistics from the University of Toronto in 2021.

**Justin Lee**. Justin is a junior consultant with Zeusolutions. He specializes in data analytics. Justin earned his Bachelor of Science, Majoring in Statistics and Mathematics from the University of Toronto in 2021. 

## Code of ethical conduct

Zeusolutions strives to be a forefront in professional statistical work while maintaining the integrity, security and privacy of our customers. We believe in executing our work with proper due diligence and informative research. This is why we believe in the following.

1.	Maintaining the trust of our customers as a vital part of our company’s asset.  
2.	Privacy of our customers is essential in all our statistical work. We do not disclose or seek personal gain from any information given to us by our customers. Any possible interest that can be regarded as influencing the results of our statistical work will be clearly communicated. 
3.	Appropriate security measures and practices take place amongst our employees to ensure sensitive information is kept safe. 
4.	Support for all employees. All statistical work performed with Zeusolutions is appropriately credited to all employees involved. 
5.	Ensure the disclosure of all limitations and assumptions made in relevance to data of any particular work. 

We recognize these importance’s and responsibilities we ought to uphold to our customers. 

_This section should be fairly short, no more than half a page. Assume a general audience, much like your executive summary._

* _Make at least three relevant statements about your company’s approach to ethical statistical consulting. These should be appropriately in line with professional conduct advice like the (Statistical Society of Canada Code of Conduct)[https://ssc.ca/sites/default/files/data/Members/public/Accreditation/ethics_e.pdf] or the (Ethical Guidelines for Statistical Practice from the American Statistical Society)[https://www.amstat.org/ASA/Your-Career/Ethical-Guidelines-for-Statistical-Practice.aspx]. For example, "the customer is always right" ISN’T the type of thing an ethical statistical consultant would include._
*	_Be very careful not to just copy and paste from these other documents! Put things in your own words._


__Final advice: KNIT EARLY AND OFTEN!__
